---
import { t, changeLanguage } from "i18next";
import Layout from "@layouts/Layout.astro";
import { Img, Picture } from "astro-imagetools/components";
import productsJson from "@data/products.json";
import { utilAddLocalePathname } from "@services/utilService";
import EyeIcon from "@assets/EyeIcon.astro";
import advancedEquipmentJson from "@data/advanced-equipment.json";
import contactUsJson from "@data/contact-us.json";
import CaretIcon from "@assets/CaretIcon.astro";

changeLanguage("en");

const productCategories = productsJson.navlinks;
const protectionProducts = [
    {
        name: "face-shields",
        href: "/products/full-face-shields",
        imgSrc: "/images/products/full-face-shields/1.jpeg",
    },
    {
        name: "kids-goggles",
        href: "/products/kids-goggles",
        imgSrc: "/images/products/kids-goggles/kids-goggles-1.jpeg",
    },
    {
        name: "adult-goggles",
        href: "/products/adult-goggles",
        imgSrc: "/images/products/adult-goggles/adult-goggles-1.jpeg",
    },
    {
        name: "kids-face-shields",
        href: "/products/kids-face-shields",
        imgSrc: "/images/products/face-shields/kids-face-shield-1.jpeg",
    },
];
const categoryImages = [
    "/images/home/category-1.jpeg",
    "/images/home/category-2.jpeg",
    "/images/home/category-3.jpeg",
    "/images/home/category-4.jpeg",
];
const products = productsJson.contents;
const certificates = [
    "/images/about-us/certificates/01.jpg",
    "/images/about-us/certificates/02.jpg",
    "/images/about-us/certificates/03.jpg",
    "/images/about-us/certificates/04.jpg",
    "/images/about-us/certificates/05.jpeg",
    "/images/about-us/certificates/06.jpeg",
    "/images/about-us/certificates/07.jpeg",
];
const partners = [
    "/images/partners/1.jpeg",
    "/images/partners/2.jpeg",
    "/images/partners/3.jpeg",
    "/images/partners/4.png",
    "/images/partners/5.png",
    "/images/partners/6.png",
    "/images/partners/7.png",
    "/images/partners/8.png",
    "/images/partners/9.png",
    "/images/partners/10.jpeg",
    "/images/partners/11.jpeg",
    "/images/partners/12.png",
];
const automations = [
    {
        name: "design",
        imgSrc: "/images/automations/design.jpeg",
    },
    {
        name: "print",
        imgSrc: "/images/automations/print.jpeg",
    },
    {
        name: "cut",
        imgSrc: "/images/automations/die-cut.jpeg",
    },
    {
        name: "glue",
        imgSrc: "/images/automations/glue.jpeg",
    },
];
const advancedEquipments = advancedEquipmentJson.contents;
---

<Layout>
  <section class="relative">
    <swiper-container init="false" data-hero-carousel>
      <swiper-slide lazy="true">
        <Img src="/images/home/hero-2.jpeg" alt="hero-2" />
      </swiper-slide>

      <swiper-slide lazy="true">
        <Img src="/images/home/hero-1.jpeg" alt="hero-1" />
      </swiper-slide>
    </swiper-container>

    <section
      class="hidden container left-0 right-0 absolute z-[1] top-1/2 w-full -translate-y-1/2 justify-between lg:flex"
    >
      <button
        data-hero-carousel-prev
        class="bg-gray-900 text-white w-12 -rotate-90 h-12 rounded-full transition opacity-50 hover:opacity-100"
      >
        <CaretIcon />
      </button>

      <button
        data-hero-carousel-next
        class="bg-gray-900 text-white w-12 rotate-90 h-12 rounded-full transition opacity-50 hover:opacity-100"
      >
        <CaretIcon />
      </button>
    </section>
  </section>

  <!-- Video -->
  <section class="my-8 container">
    <div class="relative pb-[50%]">
      <iframe
        title="Donge Introduction Video"
        class="w-full h-full absolute"
        src="https://player.youku.com/embed/XNTg4NTI2MDc5Ng=="
        'allowfullscreen'></iframe>
    </div>
  </section>

  <hr class="border-dashed my-8 border-gray-300" />

  <!-- About us -->
  <section class="container my-8">
    <figure class="flex flex-wrap">
      <div class="flex w-full justify-between lg:w-fit">
        <div class="w-4 border-l-2 border-t-2 border-gray-500"></div>

        <header class="self-center text-p font-bold text-center">
          <h2 class="text-5xl">{t("about")}</h2>
          <p class="text-2xl">{t("dongke")}</p>
        </header>

        <div class="w-4 border-r-2 border-b-2 border-gray-500"></div>
      </div>

      <figcaption class="flex-1 mt-8 lg:mt-0 lg:pl-8">
        <ul>
          <li>
            {t("about-details-1")}
          </li>

          <li>
            {t("about-details-2")}
          </li>

          <li>
            {t("about-details-3")}
          </li>

          <li>
            {t("about-details-4")}
          </li>
        </ul>
      </figcaption>
    </figure>
  </section>

  <!-- Product Categories -->
  <section class="bg-gray-100 py-8">
    <section class="flex flex-wrap container">
      <aside class="flex flex-col w-full lg:w-72">
        <header class="text-center bg-p p-2 text-white">
          <span class="text-7xl">D.K.</span>
          <h2 class="text-xl uppercase">{t("product-categories")}</h2>
        </header>

        <section class="border-x border-b flex-1">
          <ul class="px-2 py-4 flex flex-wrap lg:space-y-2">
            {
              productCategories.map((productCategory) => {
                const { name, pathname } = productCategory;
                return (
                  <li class="w-1/2 p-1 flex lg:w-full">
                    <a
                      class="px-4 py-2 flex items-center w-full bg-slate-700 text-white rounded-md transition hover:bg-p"
                      href={utilAddLocalePathname({ pathname })}
                    >
                      {t(name)}
                    </a>
                  </li>
                );
              })
            }
          </ul>
        </section>
      </aside>

      <section class="flex-1 w-1/2 space-y-4 mt-4 lg:mt-0 lg:px-4">
        <section class="relative">
          <swiper-container init="false" data-category-carousel>
            {
              categoryImages.map((image) => {
                return (
                  <swiper-slide>
                    <Img src={image} alt="Category" />
                  </swiper-slide>
                );
              })
            }
          </swiper-container>

          <section
            class="hidden container left-0 right-0 absolute z-[1] top-1/2 w-full -translate-y-1/2 justify-between lg:flex"
          >
            <button
              data-category-carousel-prev
              class="bg-gray-900 text-white w-12 -rotate-90 h-12 rounded-full transition opacity-50 hover:opacity-100"
            >
              <CaretIcon />
            </button>

            <button
              data-category-carousel-next
              class="bg-gray-900 text-white w-12 rotate-90 h-12 rounded-full transition opacity-50 hover:opacity-100"
            >
              <CaretIcon />
            </button>
          </section>
        </section>

        <ul class="flex flex-wrap -mx-2 overflow-hidden">
          {
            protectionProducts.map((product) => {
              const name = t(`${product.name}`);

              return (
                <li class="p-2 w-1/2 md:w-1/4">
                  <figure>
                    <div>
                      <Img src={product.imgSrc} alt={`Picture of ${name}`} />
                    </div>

                    <figcaption class="text-center mt-4">
                      <p>{name}</p>

                      <footer class="mt-2">
                        <button class="flex px-4 py-0.5 border-gray-400 mx-auto items-center space-x-2 border rounded-md transition hover:text-p">
                          <div class="w-5 h-5">
                            <EyeIcon />
                          </div>
                          <span> {t("detail")}</span>
                        </button>
                      </footer>
                    </figcaption>
                  </figure>
                </li>
              );
            })
          }
        </ul>
      </section>
    </section>
  </section>

  <!-- Product List -->
  <section class="container py-8">
    <header>
      <h2 class="text-4xl text-p text-center font-bold">
        {t("product-list")}
      </h2>
    </header>

    <section class="mt-4">
      <ul class="flex flex-wrap -mx-2 overflow-hidden">
        {
          [...products].splice(0, 8).map((product) => {
            const category = product.category[0];
            const subCategory = product.subCategory[0] ?? "all";
            const href = utilAddLocalePathname({
              pathname: `/products/${category}/${subCategory}/${product.slug}`,
            });
            const image = product.images[0];
            const name = t(`products:${product.slug}`);
            return (
              <li class="p-2 w-1/2 md:w-1/3 lg:w-1/4">
                <a href={href}>
                  <figure class="relative border transition group overflow-hidden hover:border-p">
                    <div class="transition duration-1000 group-hover:scale-110">
                      <Img src={image} alt={`Picture of ${name}`} />
                    </div>

                    <figcaption class="absolute bg-black bg-opacity-75 p-2 w-full bottom-0">
                      <p class="text-center text-white">{name}</p>
                    </figcaption>
                  </figure>
                </a>
              </li>
            );
          })
        }
      </ul>
    </section>
  </section>

  <!-- Certificates -->
  <section class="container">
    <header class="flex items-center space-x-4">
      <div class="flex-1 border-t">
        <div class="w-1/5 border-t border-p"></div>
      </div>
      <h2 class="capitalize text-4xl text-center text-p font-bold">
        {t("honor-certificates")}
      </h2>
      <div class="flex-1 border-t">
        <div class="w-1/5 border-t border-p ml-auto"></div>
      </div>
    </header>

    <section class="my-8">
      <swiper-container init="false" data-certificate-carousel>
        {
          certificates.map((cert) => {
            return (
              <swiper-slide>
                <Img src={cert} alt="Certificate" />
              </swiper-slide>
            );
          })
        }
      </swiper-container>
    </section>
  </section>

  <!-- Partners -->
  <section class="container">
    <header class="flex items-center space-x-4">
      <div class="flex-1 border-t">
        <div class="w-1/5 border-t border-p"></div>
      </div>
      <h2 class="capitalize text-4xl text-center text-p font-bold">
        {t("partners")}
      </h2>
      <div class="flex-1 border-t">
        <div class="w-1/5 border-t border-p ml-auto"></div>
      </div>
    </header>

    <section class="my-8">
      <ul class="flex flex-wrap">
        {
          partners.map((partner) => {
            return (
              <li class="p-2 w-1/2 md:w-1/4 lg:w-1/6">
                <div class="border">
                  <Picture src={partner} alt="Certificate" />
                </div>
              </li>
            );
          })
        }
      </ul>
    </section>
  </section>

  <!-- Ad section -->
  <section class="hidden relative pointer-events-none xl:block">
    <div class="absolute w-full h-full">
      <p
        class="text-2xl tracking-tight absolute top-[20%] left-1/2 -translate-x-1/2"
      >
        {t("ad-title")}
      </p>
      <div
        class="border py-1 border-gray-500 px-8 absolute top-[40%] left-1/2 -translate-x-[55%]"
      >
        <p class="text-p font-bold">
          {t("ad-subtitle")}
        </p>
      </div>

      <div class="absolute left-3/4 top-1/2 -translate-y-[75%] text-center">
        <p>{t("hotline")}</p>
        <p class="text-p text-xl">+86{contactUsJson.liao}</p>
        <p>{t("email")}</p>
        <p class="text-p text-xl">{contactUsJson.email}</p>
      </div>

      <p
        class="absolute bottom-[21%] font-medium right-1/2 -translate-x-2/3 text-white"
      >
        {t("ad-footer")}
      </p>
    </div>
    <Img src="/images/ad.jpg" alt="ad" />
  </section>

  <!-- Automations -->
  <section class="container my-4">
    <header class="flex justify-center items-center space-x-4">
      <div class="w-24 border-t-2 border-gray-500"></div>
      <h2 class="text-4xl text-center text-p font-bold">
        {t("automation-title")}
      </h2>
      <div class="w-24 border-t-2 border-gray-500"></div>
    </header>

    <p class="text-lg text-center">
      {t("automation-subtitle")}
    </p>

    <section class="mt-8">
      <figure class="flex flex-wrap">
        <div class="w-full lg:w-1/2">
          <swiper-container init="false" data-automation-carousel>
            {
              automations.map((automation) => {
                return (
                  <swiper-slide>
                    <Img
                      src={automation.imgSrc}
                      alt={`Picture of ${automation.name}`}
                    />
                  </swiper-slide>
                );
              })
            }
          </swiper-container>
        </div>

        <figcaption
          class="w-full mt-4 text-sm space-y-2 lg:pl-8 lg:mt-0 lg:w-1/2"
        >
          <p class="text-center">
            {t("production-technology-management-system")}
          </p>

          <ul class="space-y-4">
            {
              automations.map((automation) => {
                return (
                  <li>
                    <figure class="px-4 py-2 border-2 flex space-x-4 items-center">
                      <div class="rounded-full flex items-center justify-center text-white bg-p w-16 h-16">
                        <p class="font-bold">{t(automation.name)}</p>
                      </div>

                      <figcaption class="flex-1">
                        <p>{t(`${automation.name}-details`)}</p>
                      </figcaption>
                    </figure>
                  </li>
                );
              })
            }
          </ul>
        </figcaption>
      </figure>
    </section>
  </section>

  <section class="container my-8">
    <header class="flex items-center space-x-4">
      <div class="flex-1 border-t">
        <div class="w-1/5 border-t border-p"></div>
      </div>
      <h2 class="capitalize text-4xl text-center text-p font-bold">
        {t("advanced-equipment")}
      </h2>
      <div class="flex-1 border-t">
        <div class="w-1/5 border-t border-p ml-auto"></div>
      </div>
    </header>

    <section class="mt-8">
      <swiper-container init="false" data-equipment-carousel>
        {
          [...advancedEquipments, ...advancedEquipments].map((equipment) => {
            return (
              <swiper-slide>
                <Img src={equipment.src} alt={equipment.name} />
              </swiper-slide>
            );
          })
        }
      </swiper-container>
    </section>
  </section>
</Layout>

<script>
  import { type SwiperOptions, type Swiper } from "swiper/types";
  // import function to register Swiper custom elements
  import { register } from "swiper/element/bundle";
  // register Swiper custom elements
  register();

  const heroCarousel: { swiper: Swiper; initialize: any } =
    document.querySelector("[data-hero-carousel]") as any;
  const heroCarouselParams: SwiperOptions = {
    slidesPerView: 1,
    loop: true,
    autoplay: {
      delay: 5000,
      disableOnInteraction: false,
    },
    pagination: true,
    navigation: {
      nextEl: "[data-hero-carousel-next]",
      prevEl: "[data-hero-carousel-prev]",
    },
    speed: 1000,
  };

  const equipmentCarousel: { swiper: Swiper; initialize: any } =
    document.querySelector("[data-equipment-carousel]") as any;
  const equipmentCarouselParams: SwiperOptions = {
    slidesPerView: 2,
    autoplay: {
      delay: 2000,
    },
    loop: true,
    spaceBetween: 12,
    breakpoints: {
      768: {
        slidesPerView: 3,
      },
      1024: {
        slidesPerView: 4,
      },
      1440: {
        slidesPerView: 5,
      },
    },
  };

  const automationCarousel: { swiper: Swiper; initialize: any } =
    document.querySelector("[data-automation-carousel]") as any;
  const automationCarouselParams: SwiperOptions = {
    slidesPerView: 1,
    autoplay: {
      delay: 2000,
    },
    loop: true,
  };

  const certificateCarousel: { swiper: Swiper; initialize: any } =
    document.querySelector("[data-certificate-carousel]") as any;
  const certificateCarouselParams: SwiperOptions = {
    slidesPerView: 2,
    autoplay: {
      delay: 2000,
    },
    pagination: true,
    spaceBetween: 12,
    breakpoints: {
      768: {
        slidesPerView: 4,
      },
      1024: {
        slidesPerView: 5,
      },
      1440: {
        slidesPerView: 7,
      },
    },
  };

  const categoryCarousel: { swiper: Swiper; initialize: any } =
    document.querySelector("[data-category-carousel]") as any;
  const categoryCarouselParams: SwiperOptions = {
    slidesPerView: 1,
    autoplay: {
      delay: 2000,
    },
    loop: true,
    pagination: true,
    navigation: {
      nextEl: "[data-category-carousel-next]",
      prevEl: "[data-category-carousel-prev]",
    },
  };

  // Initialize hero carousel
  Object.assign(heroCarousel, heroCarouselParams);
  heroCarousel.initialize();

  // Initialize equipment carousel
  Object.assign(equipmentCarousel, equipmentCarouselParams);
  equipmentCarousel.initialize();

  // Initialize automation carousel
  Object.assign(automationCarousel, automationCarouselParams);
  automationCarousel.initialize();

  // Initialize certificate carousel
  Object.assign(certificateCarousel, certificateCarouselParams);
  certificateCarousel.initialize();

  // Initialize category carousel
  Object.assign(categoryCarousel, categoryCarouselParams);
  categoryCarousel.initialize();
</script>
