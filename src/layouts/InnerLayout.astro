---
import HomeIcon from "@assets/HomeIcon.astro";
import Layout, { type LayoutProps } from "./Layout.astro";
import { Img } from "astro-imagetools/components";
import {
  utilFixPathname,
  utilRemoveLocalePathname,
  utilAddLocalePathname,
} from "@services/utilService";
import { t } from "i18next";

type Props = {
  bannerSrc: string;
  bannerAlt: string;
} & LayoutProps;

let { bannerSrc, bannerAlt } = Astro.props as Props;
bannerAlt = t(bannerAlt);
const { pathname: astroPathname } = Astro.url;

const path = utilFixPathname(
  utilRemoveLocalePathname({ pathname: astroPathname })
);
const pathsSplitted = path.split("/");
const crumbs = pathsSplitted.map((slug, index) => {
  const pathname = pathsSplitted.slice(0, index + 1).join("/");
  return {
    slug: slug || "home",
    pathname: pathname || "/",
  };
});
---

<Layout>
  <!-- Content banner -->
  <section class="min-h-[25vh] relative">
    <div class="absolute w-full h-full lg:relative">
      <Img objectFit="cover" src={bannerSrc} alt={bannerAlt} />
    </div>
  </section>

  <!-- Breadcrumbs -->
  <section class="shadow-lg">
    <section class="container flex py-2 items-center">
      <div class="w-5 h-5 mr-2 text-gray-500 hidden md:block">
        <HomeIcon />
      </div>

      <h2 class="text-2xl uppercase mr-auto hidden md:block">
        {bannerAlt}
      </h2>

      <div class="text-sm text-gray-500">
        <nav>
          <ul class="flex flex-wrap">
            <li class="font-medium">You are here:</li>
            {
              crumbs.map((crumb, index) => {
                const { slug, pathname } = crumb;
                const translated = t([slug, ""]);

                if (translated) {
                  return (
                    <li>
                      {index > 0 && <span>&gt;&gt;</span>}
                      <a
                        class="mx-1 hover:text-gray-700"
                        href={utilAddLocalePathname({ pathname })}
                      >
                        {t(slug)}
                      </a>
                    </li>
                  );
                }
              })
            }
          </ul>
        </nav>
      </div>
    </section>
  </section>

  <!-- More Content -->
  <slot />
</Layout>
